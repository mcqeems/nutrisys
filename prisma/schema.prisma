generator client {
  provider = "prisma-client"
  // Moved generated client into src/ to avoid creating a top-level app/ folder
  output   = "../src/generated/prisma"
  runtime  = "bun"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String            @id @default(cuid())
  name            String?
  email           String            @unique
  emailVerified   DateTime?
  image           String?
  passwordHash    String? // Stored bcrypt hash
  accounts        Account[]
  sessions        Session[]
  // Optional for WebAuthn support
  Authenticator   Authenticator[]
  // For other things
  chat_logs       chat_logs[]
  food_logs       food_logs[]
  journal_entries journal_entries[]
  notifications   notifications[]
  summary         summary[]
  user_info       user_info[]
  user_targets    user_targets[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

// Optional for WebAuthn support
model Authenticator {
  credentialID         String  @unique
  userId               String
  providerAccountId    String
  credentialPublicKey  String
  counter              Int
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, credentialID])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model chat_logs {
  id          Int       @id @default(autoincrement())
  user_id     String    @db.VarChar(255)
  session_id  String    @db.VarChar(255)
  sender_type String    @db.VarChar(50)
  message     String
  timestamp   DateTime? @default(now()) @db.Timestamptz(6)
  user        User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([session_id], map: "idx_chat_logs_session_id")
  @@index([user_id], map: "idx_chat_logs_user_id")
}

model food_logs {
  id          Int       @id @default(autoincrement())
  user_id     String    @db.VarChar(255)
  log_date    DateTime? @default(now()) @db.Timestamptz(6)
  input_type  String    @db.VarChar(50)
  image_url   String?   @db.VarChar(255)
  description Json?
  user        User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String?
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model journal_entries {
  id         Int       @id @default(autoincrement())
  user_id    String    @db.VarChar(255)
  entry_date DateTime? @default(now()) @db.Timestamptz(6)
  mood       String?   @default("neutral") @db.VarChar(50)
  content    String
  ai_reply   String?
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String?
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model notifications {
  id         Int       @id @default(autoincrement())
  user_id    String    @db.VarChar(255)
  message    String
  type       String?   @default("info") @db.VarChar(50)
  is_read    Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String?
}

model summary {
  id           Int       @id @default(autoincrement())
  user_id      String    @unique @db.VarChar(255)
  description  String?
  generated_at DateTime? @default(now()) @db.Timestamptz(6)
  user         User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       String?
}

model user_info {
  id              Int       @id @default(autoincrement())
  user_id         String    @unique @db.VarChar(255)
  gender          String?   @db.VarChar(50)
  height          Int?
  weight          Int?
  blood_type      String?   @db.VarChar(10)
  food_allergy    String?
  medical_history String?
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  user            User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String?
}

model user_targets {
  id         Int       @id @default(autoincrement())
  user_id    String    @db.VarChar(255)
  name       String    @db.VarChar(255)
  start_date DateTime  @db.Date
  end_date   DateTime  @db.Date
  status     String?   @default("active") @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String?
}
